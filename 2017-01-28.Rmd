---
title: "An analysis and visualization of a holiday classic"
layout: post
date: 2017-01-28 20:20
image: /assets/images/markdown.jpg
headerImage: false
tag:
- Gary's Anatomy
- Text Mining
category: blog
author: WeifanD
---

```{r warning=FALSE, message=FALSE}
library(dplyr) # data manipulation
library(tidytext) # text mining
library(tidyr) # data manipulation
library(stringr) # string manipulation
knitr::opts_chunk$set(warning=FALSE, message=FALSE,comment = NA)
```

ä»Šå¤©æ˜¯å¤§å¹´åˆä¸€ï¼Œæ˜¯ä¸ªå¥½æ—¥å­ï¼Œè€³è¾¹ä¼ æ¥çš„æ˜¯å°å²³å²³çš„æ­Œå£°ï¼Œæ‰‹ä¸‹æ­£æ•²æ‰“ç€é”®ç›˜ï¼Œæƒ³è¯´ä¸€å®šè¦æŠŠè¿™ä¸ªå°å‘ç»™å¡«äº†ï¼ï¼

æ•°æ®æŒ–æ˜ä¸­æ–‡æœ¬æŒ–æ˜ä¸€ç›´è§‰å¾—æ˜¯æŒºæœ‰æ„æ€çš„ä¸»é¢˜ï¼Œä»Šå¤©å°±æ¨¡ä»¿ç€David Robinsonçš„[love actually](http://varianceexplained.org/r/love-actually-network/)

é¦–å…ˆå½“ç„¶å°±æ˜¯è·å¾—æ•°æ®æ–‡æœ¬ï¼Œå°±åœ¨ç™¾åº¦ä¸Šæœäº†ä¸€éƒ¨æˆ‘æœ€å–œæ¬¢çš„åŒ»å­¦ç¾å‰§ï¼Œ'Gary's Anatomy'!

```{r echo=FALSE}
raw <- readLines("gary's anatomy.txt")
dialogue <- data_frame(raw = raw) %>% 
  filter(raw != "", !is.na(raw)) %>% 
  separate(raw, c("form","content"),sep = ": ",fill = "left") %>% 
  mutate(form = ifelse(is.na(form), "Others", form)) %>% 
  mutate(is_scene = str_detect(form, "2x"),
         scene = cumsum(is_scene))
head(dialogue)
```

å¥½äº†ç°åœ¨æˆ‘ä»¬ç®—æ˜¯å¯¹raw dataè¿›è¡Œäº†initial manipulation,ä¸€ä¸ªtidy dataçš„è¿‡ç¨‹ã€‚å½“ç„¶è¿™é‡Œç®—æ˜¯å¾ˆç®€å•äº†ï¼Œæ­£å¸¸æ•°æ®æŒ–æ˜ä¸­data cleaningé€šå¸¸è¦èŠ±è´¹ä¸€ådata analyst60%çš„æ—¶é—?.

æˆ‘åœ¨ç½‘ä¸Šæ‰¾åˆ°çš„è¿™ä¸ªå‰§æœ¬æ˜¯æ ¼é›·ç¬¬äºŒå­£ï¼ŒåŒ…æ‹¬äº†æœ¬é›†åå­—ï¼æ¼”å‘˜çš„å°è¯ä»¥åŠåœºæ™¯è½¬æ¢ï¼Œå½“ç„¶è¿˜æœ‰æˆ‘è§‰å¾—æœ€æœ‰æ„æ€çš„æ—ç™½ã€?
å…ˆçœ‹çœ‹ç©¶ç«Ÿç¬¬äºŒå­£æœ‰å“ªäº›ä¸»é¢˜ï¼Œéƒ½æ˜¯è°å†™çš„ï¼Œå‰§æœ¬ä¸­ç”¨åˆ°çš„é«˜é¢‘å•è¯æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå°è¯é¢‘ç‡æœ€é«˜çš„æ˜¯ä¸æ˜¯å°±æ˜¯æˆ‘ä»¬å°è±¡ä¸­çš„é‚£äº›ä¸»è§’ï¼Ÿ

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œç¬¬äºŒå­£æ€»å…±27é›†ï¼Œæœ‰æ²¡æœ‰ä½ å°è±¡æœ€æ·±çš„ä¸€é›†å‘¢ï¼Ÿæˆ‘æƒ³ç¬¬ä¸€é›†çš„writerå¯èƒ½æ²¡æƒ³åˆ°å¤šå¹´ä¹‹åï¼Œæœ‰ä¸€ä¸ªèƒ–èƒ–çš„å¥³ç”Ÿå”±äº†ä¸€é¦–è¶³å¤Ÿéœ‡æ’¼åŠ¨äººå¿ƒé­„çš„æ­Œæ›²ï¼Œå¥¹çš„ç¬¬ä¸€å¥éŸ³èµ·å°±æ˜¯â€œWhen the rain is blowing in your eyes and the whole world is on your caseâ€ï½

![center](http://p1.bqimg.com/567571/1efbc299a455094c.png)

```{r}
library(tidytext)
reg <- "([^A-Za-z\\d#@']|'(?![A-Za-z\\d#@]))"
dialogue_words <- dialogue %>%
  select(content) %>% 
  unnest_tokens(word, content, token = "regex", pattern = reg) %>% 
  filter(!word %in% stop_words$word)

library(wordcloud2)
dialogue_words %>% 
  count(word, sort = T) %>% 
  as.data.frame(.) %>% 
  wordcloud2(size = 1.5, shape = 'star')

senti_stat <- dialogue_words %>% 
  inner_join(sentiments)
  
senti_stat %>% 
  filter(sentiment == "positive") %>% 
  count(word, sort = T) %>% 
  as.data.frame(.) %>% 
  wordcloud2(size = 1)
```
![center](http://p1.bqimg.com/567571/3138b92876a22807.png)

ä½œä¸ºä¸€éƒ¨å…¸å‹çš„ç¾å‰§ï¼Œæ ¼é›·çš„å°è¯é™¤å´åŒ»å­¦ä¸“ç”¨æ­¤å¤–ï¼Œæ—¥å¸¸å¸¸ç”¨è¯è¿˜æ˜¯å å¤šæ•°çš„ï¼Œåƒä»€ä¹ˆgodï¼ahï¼guyä¹‹ç±»çš„å£å¤´è¯­ï¼Œchiefï¼Drçš„titleï¼Œå½“ç„¶ä¹Ÿæœ‰åŒ»å­¦é¢˜æä¸å¯é¿å…çš„surgeryï¼Œæ¥ä¸‹æ¥çœ‹çœ‹è¿™éƒ¨å‰§ç§¯æçš„æƒ…ç»ªè¯é¢‘ã€?
è·Ÿæƒ³è±¡ä¸­å·®ä¸å¤šï¼Œluckyï¼loveï¼happyå é¦–ä½?

æ¥ä¸‹æ¥æˆ‘ä»¬æŒ–ä¸€ä¸‹äººç‰©å…³ç³»å§

![](http://p1.bqimg.com/567571/0aae117158654918.png)

```r  
lines <- character_df %>%
    filter(!is_scene) %>%
    rename(speaker = form, dialogue = content) %>% 
    group_by(scene, line = cumsum(!is.na(speaker))) %>%
    summarize(speaker = speaker[1], dialogue = str_c(dialogue, collapse = " ")) %>% 
  mutate(speaker = str_replace(speaker,"\\(.+", "")) %>% 
  filter(!is.na(speaker))
```

ç°åœ¨æ¯é›†æ¯ä¸ªäººæ¯å¥å°è¯å½¢æˆä¸€è¡Œï¼Œä¹Ÿå°±æ˜¯one scene one line one observation, å°†å…¶è½¬å˜æˆâ€œspeaker-by-scene matrixâ€ï¼Œä¸ºä¹‹åçš„èšç±»åšå‡†å¤‡ã€?

å•¦å•¦å•¦æˆ‘ä»¬äº”å¤§ä¸»è§’æœç„¶èšåœ¨ä¸€èµ·äº†ï¼Œè°å«ä»–ä»¬å·¥ä½œåœ¨ä¸€èµ·ä½è¿˜ä½ä¸€èµ·ï½

![center](http://p1.bpimg.com/567571/8ab454ce2effc2ca.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯ä¸€é›†å‡ºç°äººç‰©çš„å…³ç³»çº¿ï¼ŒAlexå±…ç„¶ç¬¬ä¹é›†æ²¡æœ‰å‡ºåœºï¼ŒMarkç¬?18é›†æ‰å‡ºåœºï¼Œçœ‹æ¥æˆ‘å¾—å»å›é¡¾ä¸€ä¸‹ç¬¬äºŒå­£äº†ï¼Œå…ˆåˆ°è¿™é‡Œç­‰æˆ‘reviewå‰§ä¹‹åå†æŠŠåŸ‹ä¸€ä¸‹ã€?

